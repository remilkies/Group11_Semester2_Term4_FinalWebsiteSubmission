<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE-edge">
    <meta name="viewport" content="width-device-width, initial-scale-1.0">
    <meta name="author" content="Syntax Slayers">
    <meta name="keywords" content="movie, movies, watchlist, dream list">

    <title>Dream List - Dream Stream</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Comfortaa&family=Emblema+One&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
    <link rel="stylesheet" href="../css/main.css">
</head>

<body>

<header>
    <nav class="navbar">
        <div class="container-fluid">
          <a class="navbar-profile" href="../pages/log-in.html">Welcome <br> Please Login</a>
          
          <div class="pageTitle flex-fill">
            <h1>DREAM LIST</h1>
            <h2>YOUR CONSTELLATION OF MOVIES TO WATCH</h2>
          </div>

          <button class="navbar-toggle" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasNavbar" aria-controls="offcanvasNavbar" aria-label="Toggle navigation">
            <img src="../assets/logo/logo.png">
          </button>

          <div class="offcanvas offcanvas-end" tabindex="-1" id="offcanvasNavbar" aria-labelledby="offcanvasNavbarLabel">
              <h1 class="navbar-header inline-flex"><img src="../assets/logo/logo.png">Browse</h1>

            <div class="offcanvas-body">
              <ul class="navbar-nav justify-content-end flex-grow-1 pe-3">

                <form class="d-flex navbar-searchBar" role="search">
                  <input class="form-control me-2" type="search" placeholder="Search" aria-label="Search"/>
                </form>

                <li class="nav-item">
                  <a class="nav-link" href="../index.html"> 
                    <img src="../assets/icons/starIconActive.png" class="nav-icon">
                    <h2>Home</h2>
                  </a>
                </li>

                <li class="nav-item">
                  <a class="nav-link active" aria-current="page" href="../pages/watchlist.html">
                    <img src="../assets/icons/starIconActive.png" class="nav-icon">
                    <h2>Dream List</h2>
                  </a>
                </li>

                <li class="nav-item">
                  <a class="nav-link" href="../pages/movie-library.html">
                    <img src="../assets/icons/starIconActive.png" class="nav-icon">
                    <h2>Library</h2>
                  </a>
                </li>

                <li class="nav-item dropdown">
                  <a class="nav-link" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                    <img src="../assets/icons/starIconActive.png" class="nav-icon">
                    <h2>Genres</h2>
                  </a>

                  <ul class="dropdown-menu">
                    <li class="nav-item">
                      <a class="nav-link" href="#">
                        <img src="../assets/icons/starIconActive.png" class="nav-icon">
                        <h2>Action</h2>
                      </a>
                    </li>
                    <li class="nav-item">
                      <a class="nav-link" href="#">
                        <img src="../assets/icons/starIconActive.png" class="nav-icon">
                        <h2>Horror</h2>
                      </a>
                    </li>
                  </ul>
                </li>

              </ul>
            </div>
          </div>
        </div>
      </nav>
</header>

<!-- Filter/Sort Bar -->
<div class="d-flex filter-bar align-items-center flex-wrap">
    <div class="me p-2">
      <form class="d-flex movie-searchBar" role="search">
        <input class="form-control me-2" type="search" placeholder="Search your dream list" aria-label="Search" id="searchInput"/>
      </form>
    </div>
    
    <div class="d-flex ms-auto p-2"> 
      <div class="p-2">Sort:</div>
      <div class="p-2" style="cursor: pointer;" id="sortRecent">Recently Added</div>
      <div class="p-2" style="cursor: pointer;" id="sortTitle">Title</div>
      <div class="p-2" style="cursor: pointer;" id="sortRating">Rating</div>
    </div>
</div>

<!-- Empty State -->
<div id="emptyState" style="display: none; text-align: center; padding: 100px 20px;">
    <h2 style="margin-bottom: 20px; color: #F2E0C7;">Your Dream List is Empty</h2>
    <p style="margin-bottom: 30px; color: #F2E0C7;">Start adding movies to your watchlist from the homepage or library!</p>
    <div class="d-flex justify-content-center">
        <a href="../index.html">
            <img src="../assets/buttons/libraryButton.png" height="66px" alt="Browse Movies" style="cursor: pointer;">
        </a>
    </div>
</div>

<!-- Watchlist Container -->
<section class="movieContainer" id="watchlistContainer">
    <h2>Your Dreams Waiting to be Streamed</h2>
    <div class="container-fluid scrolling-wrapper">
      <div class="d-flex align-content-start flex-wrap" id="watchlistMovies">
        <!-- Movies will be loaded here by JavaScript -->
      </div>
    </div>
</section>

<script>

  // ============================================
// WATCHLIST PAGE SCRIPT - Save as: js/watchlist-page.js
// Full functionality: Search, Sort, Remove
// ============================================

const WatchlistManager = {
    KEY: 'dreamStreamWatchlist',
    
    getAll() {
        try {
            const data = localStorage.getItem(this.KEY);
            return data ? JSON.parse(data) : [];
        } catch (e) {
            console.error('Error reading watchlist:', e);
            return [];
        }
    },
    
    remove(movieID) {
        try {
            let watchlist = this.getAll();
            watchlist = watchlist.filter(m => m.movieID !== movieID);
            localStorage.setItem(this.KEY, JSON.stringify(watchlist));
        } catch (e) {
            console.error('Error removing from watchlist:', e);
        }
    }
};

function createMovieCard(movie) {
    const IMAGE_BASE_URL = 'https://image.tmdb.org/t/p/w500';
    const posterUrl = movie.poster ? IMAGE_BASE_URL + movie.poster : '../assets/images/placeholder.jpg';
    const overview = movie.overview || 'No description available.';
    const truncatedOverview = overview.length > 200 ? overview.substring(0, 200) + '...' : overview;

    return `
        <div class="p-2 col" data-movie-id="${movie.movieID}" data-title="${movie.title.toLowerCase()}" data-overview="${overview.toLowerCase()}">
            <div class="card movieCard">
                <div class="moviePoster">
                    <img src="${posterUrl}" alt="${movie.title}">
                </div>

                <button class="remove-btn watchlistIcon" data-movie-id="${movie.movieID}">
                    <img src="../assets/icons/watchlistAdded.png" class="watchlistIcon" alt="Remove">
                </button>

                <div class="card-body movieInfo">
                    <a class="movie-title card-title" href="individualMovie/movie-template.html?movieId=${movie.movieID}">
                        <img src="../assets/buttons/leftButton.png" height="66px">
                        <h3>${movie.title}</h3>
                        <img src="../assets/buttons/rightButton.png" height="66px">
                    </a>
                    <p class="card-text">${truncatedOverview}</p>
                    ${movie.rating ? `<p class="card-text"><small>‚≠ê ${movie.rating}/10</small></p>` : ''}
                </div>
            </div>
        </div>
    `;
}

let currentSort = 'recent';
let allMovies = [];

function loadWatchlist(sortBy = 'recent') {
    allMovies = WatchlistManager.getAll();
    const container = document.getElementById('watchlistMovies');
    const emptyState = document.getElementById('emptyState');
    const watchlistContainer = document.getElementById('watchlistContainer');
    
    if (!container || !emptyState || !watchlistContainer) {
        console.error('Required elements not found!');
        return;
    }
    
    if (allMovies.length === 0) {
        emptyState.style.display = 'block';
        watchlistContainer.style.display = 'none';
        return;
    }
    
    emptyState.style.display = 'none';
    watchlistContainer.style.display = 'block';
    
    // Sort
    let sortedMovies = [...allMovies];
    switch(sortBy) {
        case 'title':
            sortedMovies.sort((a, b) => a.title.localeCompare(b.title));
            break;
        case 'rating':
            sortedMovies.sort((a, b) => (b.rating || 0) - (a.rating || 0));
            break;
        case 'recent':
        default:
            sortedMovies.sort((a, b) => {
                const dateA = new Date(a.addedDate || 0);
                const dateB = new Date(b.addedDate || 0);
                return dateB - dateA;
            });
    }
    
    // Render
    container.innerHTML = sortedMovies.map(movie => createMovieCard(movie)).join('');
    
    // Attach remove handlers
    document.querySelectorAll('.remove-btn').forEach(btn => {
        btn.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            const movieID = parseInt(this.dataset.movieId);
            WatchlistManager.remove(movieID);
            loadWatchlist(currentSort);
        });
    });
}

// Search
function setupSearch() {
    const searchInput = document.getElementById('searchInput');
    if (!searchInput) return;
    
    searchInput.addEventListener('input', function(e) {
        const searchTerm = e.target.value.toLowerCase().trim();
        const movieCards = document.querySelectorAll('#watchlistMovies .col');
        
        if (searchTerm === '') {
            movieCards.forEach(card => card.style.display = 'block');
            return;
        }
        
        movieCards.forEach(card => {
            const title = card.dataset.title || '';
            const overview = card.dataset.overview || '';
            
            if (title.includes(searchTerm) || overview.includes(searchTerm)) {
                card.style.display = 'block';
            } else {
                card.style.display = 'none';
            }
        });
    });
}

// Sort buttons
function setupSortButtons() {
    const sortRecent = document.getElementById('sortRecent');
    const sortTitle = document.getElementById('sortTitle');
    const sortRating = document.getElementById('sortRating');
    
    if (sortRecent) {
        sortRecent.addEventListener('click', () => {
            currentSort = 'recent';
            loadWatchlist('recent');
        });
    }
    
    if (sortTitle) {
        sortTitle.addEventListener('click', () => {
            currentSort = 'title';
            loadWatchlist('title');
        });
    }
    
    if (sortRating) {
        sortRating.addEventListener('click', () => {
            currentSort = 'rating';
            loadWatchlist('rating');
        });
    }
}

function init() {
    loadWatchlist();
    setupSearch();
    setupSortButtons();
}

if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', init);
} else {
    init();
}
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI"
    crossorigin="anonymous"></script>
<script src="../js/script.js"></script>

</body>
</html>